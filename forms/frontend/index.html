<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Student Registry Form</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @font-face {
            font-family: 'Poppins';
            src: url('../fonts/Poppins-SemiBold.ttf') format('truetype');
            font-weight: 600;
        }

        @font-face {
            font-family: 'Poppins';
            src: url('../fonts/Poppins-Regular.ttf') format('truetype');
            font-weight: 400;
        }

        body {
            font-family: 'Poppins', sans-serif;
        }

        .photo-upload input[type="file"] {
            display: none;
        }
    </style>




</head>

<body class="bg-gray-900 flex items-center justify-center min-h-screen">
    <div class="bg-gray-800 shadow-2xl rounded-2xl w-full max-w-2xl p-8 border border-gray-700">
        <h2 class="text-3xl font-semibold text-center mb-6 text-white">Student Registry</h2>
        <form class="space-y-6">

            <!-- Profile Picture -->
            <div class="flex flex-col items-center">
                <label class="block text-gray-300 font-medium mb-3">Profile Picture</label>

                <div
                    class="photo-upload relative w-32 h-40 border-2 border-dashed border-gray-500 rounded-lg flex items-center justify-center bg-gray-700 hover:bg-gray-600 transition cursor-pointer overflow-hidden">
                    <input type="file" accept="image/*" id="profile-pic" onchange="previewImage(event)">
                    <label for="profile-pic"
                        class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 hover:text-white"
                        id="upload-label">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mb-1" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 7h2l2-3h10l2 3h2v13H3V7z" />
                            <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="2" fill="none" />
                        </svg>
                        <span class="text-sm">Upload</span>
                    </label>
                    <!-- Image preview -->
                    <img id="preview" class="hidden w-full h-full object-cover rounded-lg">
                </div>
            </div>


            <!-- Name -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Name</label>
                <input type="text" name="name" placeholder="Enter full name"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                    required>
            </div>

            <!-- Father's Name -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Father's Name</label>
                <input type="text" name="father_name" placeholder="Enter father's name"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400">
            </div>

            <!-- Email -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Email</label>
                <input type="email" name="email" placeholder="Enter email"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                    required>
            </div>

            <!-- Phone Numbers -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-300 font-medium mb-1">Phone</label>
                    <input type="tel" name="phone" placeholder="Primary phone"
                        class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                        required>
                </div>
                <div>
                    <label class="block text-gray-300 font-medium mb-1">Phone 2</label>
                    <input type="tel" name="phone2" placeholder="Secondary phone"
                        class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400">
                </div>
            </div>

            <!-- Emergency Contact -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Emergency Contact</label>
                <input type="tel" name="emergency_contact" placeholder="Emergency contact number"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400">
            </div>

            <!-- DOB -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Date of Birth</label>
                <input type="date" name="dob"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                    required>
            </div>

            <!-- Address -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Address</label>
                <textarea name="address" placeholder="Enter address"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                    rows="3"></textarea>
            </div>

            <!-- Course -->
            <div>
                <label class="block text-gray-300 font-medium mb-1">Course</label>
                <select name="course"
                    class="w-full bg-gray-700 text-white border border-gray-600 rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                    required>
                    <option value="">Select a course</option>
                    <option value="science">Science</option>
                    <option value="commerce">Commerce</option>
                    <option value="arts">Arts</option>
                    <option value="it">Information Technology</option>
                </select>
            </div>


            <!-- Submit Button -->
            <div class="text-center">
                <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg shadow-lg transition transform hover:scale-105">Register</button>
            </div>

        </form>
    </div>

    <script>
        function previewImage(event) {
            const input = event.target;
            const preview = document.getElementById('preview');
            const label = document.getElementById('upload-label');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');  // show image
                    label.classList.add('hidden');       // hide upload icon/text
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        document.querySelector("form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const formElement = e.target;
            const formData = new FormData(formElement);

            // explicitly append file if needed
            const fileInput = document.getElementById("profile-pic");
            if (fileInput && fileInput.files.length > 0) {
                formData.append("profile_pic", fileInput.files[0]);
            }

            try {
                const res = await fetch("http://localhost:5000/submit", {
                    method: "POST",
                    body: formData, // no headers — browser sets multipart boundary
                });

                if (!res.ok) throw new Error("Failed to submit form");

                const result = await res.json();
                console.log("Inserted:", result);
                alert("Student registered successfully!");

                // ✅ Clear form after success
                formElement.reset();

                // Reset preview image & label
                const preview = document.getElementById("preview");
                const label = document.getElementById("upload-label");
                if (preview) {
                    preview.src = "";
                    preview.classList.add("hidden");
                }
                if (label) {
                    label.classList.remove("hidden");
                }

            } catch (err) {
                console.error(err);
                alert("Error submitting the form.");
            }
        });
    </script>


</body>

</html>